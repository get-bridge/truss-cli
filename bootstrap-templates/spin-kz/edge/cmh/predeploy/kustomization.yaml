namespace: "{{ .Params.name }}-edge"
bases:
  - ../../../modules/{{ .Params.name }}-{{ .Params.role }}/kustomize/predeploy

patchesStrategicMerge:
  - |-
    apiVersion: batch/v1
    kind: Job
    metadata:
      name: "{{ .Params.name }}-{{ .Params.role }}-predeploy-${trigger['parameters']['sha']}"
    spec:
      template:
        metadata:
          annotations:
            vault.security.banzaicloud.io/vault-role: {{ .Params.name }}-edge-{{ .Params.role }}
        spec:
          serviceAccountName: {{ .Params.name }}-edge-{{ .Params.role }}
